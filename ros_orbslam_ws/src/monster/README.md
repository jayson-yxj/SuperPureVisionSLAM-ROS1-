# Monster - åŒç›®æ·±åº¦ä¼°è®¡ ROS åŠŸèƒ½åŒ…

Monster æ˜¯ä¸€ä¸ªåŸºäºæ·±åº¦å­¦ä¹ çš„åŒç›®æ·±åº¦ä¼°è®¡ ROS åŠŸèƒ½åŒ…ï¼Œç»“åˆäº†å•ç›®æ·±åº¦å…ˆéªŒï¼ˆDepth Anything V2ï¼‰å’Œç«‹ä½“åŒ¹é…æŠ€æœ¯ï¼Œæä¾›é«˜è´¨é‡çš„å®æ—¶æ·±åº¦ä¼°è®¡ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- **æ··åˆæ·±åº¦ä¼°è®¡**ï¼šç»“åˆå•ç›®å…ˆéªŒå’ŒåŒç›®ç«‹ä½“åŒ¹é…
- **å¤šå°ºåº¦å¤„ç†**ï¼š1/16 â†’ 1/8 â†’ 1/4 åˆ†è¾¨ç‡çš„ç²—åˆ°ç²¾ç­–ç•¥
- **å®æ—¶æ€§èƒ½**ï¼šä¼˜åŒ–çš„æ¨ç†é€Ÿåº¦ï¼Œæ”¯æŒå®æ—¶åº”ç”¨
- **ROS é›†æˆ**ï¼šå®Œæ•´çš„ ROS æ¥å£ï¼Œæ˜“äºé›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ
- **å¯è§†åŒ–æ”¯æŒ**ï¼šå®æ—¶æ˜¾ç¤ºåŸå›¾ã€è§†å·®å›¾å’Œæ·±åº¦å›¾

## ğŸ¯ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Monster æ·±åº¦ä¼°è®¡ç³»ç»Ÿ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  è¾“å…¥: ImagePoseStereo (å·¦å›¾ + å³å›¾ + ä½å§¿)                  â”‚
â”‚    â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  1. å•ç›®æ·±åº¦å…ˆéªŒ (Depth Anything V2)        â”‚           â”‚
â”‚  â”‚     - ViT ç¼–ç å™¨æå–ç‰¹å¾                     â”‚           â”‚
â”‚  â”‚     - ç”Ÿæˆå•ç›®æ·±åº¦ä¼°è®¡                       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚    â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  2. ç«‹ä½“åŒ¹é…                                 â”‚           â”‚
â”‚  â”‚     - æ„å»ºä»£ä»·ä½“ç§¯ (Cost Volume)             â”‚           â”‚
â”‚  â”‚     - å‡ ä½•ç¼–ç ä½“ç§¯                           â”‚           â”‚
â”‚  â”‚     - GRU è¿­ä»£ä¼˜åŒ–                           â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚    â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  3. æ·±åº¦èåˆ                                 â”‚           â”‚
â”‚  â”‚     - Scale-Shift å¯¹é½                       â”‚           â”‚
â”‚  â”‚     - åŒåˆ†æ”¯æ›´æ–°                             â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚    â†“                                                          â”‚
â”‚  è¾“å‡º: è§†å·®å›¾ + æ·±åº¦å›¾ + å¯è§†åŒ–                              â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ ä¾èµ–é¡¹

### ROS ä¾èµ–
- `rospy`
- `sensor_msgs`
- `geometry_msgs`
- `cv_bridge`
- `message_filters`

### Python ä¾èµ–
- `torch >= 1.10`
- `torchvision`
- `opencv-python`
- `numpy`

### æ¨¡å‹æ–‡ä»¶
- Depth Anything V2 é¢„è®­ç»ƒæ¨¡å‹
- Monster é¢„è®­ç»ƒæƒé‡ï¼š`checkpoints/Zero_shot.pth`

## ğŸš€ å®‰è£…

### 1. å…‹éš†ä»“åº“
```bash
cd ~/catkin_ws/src
# å‡è®¾å·²ç»åœ¨ orbslam_depthmaping_ros_2 é¡¹ç›®ä¸­
```

### 2. å®‰è£… Python ä¾èµ–
```bash
pip3 install torch torchvision opencv-python numpy
```

### 3. ä¸‹è½½æ¨¡å‹æ–‡ä»¶
å°† Monster æ¨¡å‹æ–‡ä»¶æ”¾ç½®åœ¨ `checkpoints/` ç›®å½•ï¼š
```bash
mkdir -p checkpoints
# ä¸‹è½½ Zero_shot.pth å’Œ depth_anything_v2_vits.pth
```

### 4. ç¼–è¯‘åŠŸèƒ½åŒ…
```bash
cd ~/catkin_ws
catkin_make
source devel/setup.bash
```

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨

å¯åŠ¨ Monster æ·±åº¦ä¼°è®¡èŠ‚ç‚¹ï¼š
```bash
roslaunch monster monster_stereo.launch
```

### 2. è‡ªå®šä¹‰å‚æ•°

ä½¿ç”¨è‡ªå®šä¹‰é…ç½®ï¼š
```bash
roslaunch monster monster_stereo.launch \
    model_path:=/path/to/model.pth \
    encoder:=vits \
    baseline:=0.12 \
    focal_length:=500.0 \
    display:=true
```

### 3. ä¸ ORB-SLAM3 é›†æˆ

ç¡®ä¿ ORB-SLAM3 å‘å¸ƒ `/orb_slam3/image_pose_stereo` è¯é¢˜ï¼š
```bash
# ç»ˆç«¯ 1: å¯åŠ¨ ORB-SLAM3 (åŒç›®æ¨¡å¼)
roslaunch orb_slam3_ros stereo.launch

# ç»ˆç«¯ 2: å¯åŠ¨ Monster æ·±åº¦ä¼°è®¡
roslaunch monster monster_stereo.launch
```

## âš™ï¸ é…ç½®å‚æ•°

### æ¨¡å‹å‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `model_path` | string | `checkpoints/Zero_shot.pth` | æ¨¡å‹æƒé‡è·¯å¾„ |
| `encoder` | string | `vits` | ç¼–ç å™¨ç±»å‹ (vits/vitb/vitl/vitg) |
| `valid_iters` | int | `2` | æ¨ç†è¿­ä»£æ¬¡æ•° |

### ç›¸æœºå‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `baseline` | float | `0.12` | åŒç›®åŸºçº¿è·ç¦» (ç±³) |
| `focal_length` | float | `500.0` | ç„¦è· (åƒç´ ) |

### æ¶æ„å‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `hidden_dims` | list | `[32, 64, 96]` | éšè—å±‚ç»´åº¦ |
| `max_disp` | int | `416` | æœ€å¤§è§†å·® |
| `n_gru_layers` | int | `3` | GRU å±‚æ•° |

### æ˜¾ç¤ºå‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `display` | bool | `true` | æ˜¯å¦æ˜¾ç¤ºå¯è§†åŒ–çª—å£ |

## ğŸ“Š è¯é¢˜æ¥å£

### è®¢é˜…è¯é¢˜
- `/orb_slam3/image_pose_stereo` ([`monster/ImagePoseStereo`](msg/ImagePoseStereo.msg))
  - åŒ…å«å·¦å³å›¾åƒã€ç›¸æœºä½å§¿å’Œè·Ÿè¸ªçŠ¶æ€

### å‘å¸ƒè¯é¢˜
ï¼ˆæœªæ¥ç‰ˆæœ¬å°†æ·»åŠ ï¼‰
- `/monster/disparity` - è§†å·®å›¾
- `/monster/depth` - æ·±åº¦å›¾
- `/monster/point_cloud` - ç‚¹äº‘æ•°æ®

## ğŸ¨ å¯è§†åŒ–

èŠ‚ç‚¹è¿è¡Œæ—¶ä¼šæ˜¾ç¤ºä¸‰ä¸ªçª—å£ï¼š
1. **åŸå§‹å›¾åƒ**ï¼šå·¦ç›¸æœºå›¾åƒ
2. **è§†å·®å›¾**ï¼šå½©è‰²ç¼–ç çš„è§†å·®
3. **æ·±åº¦å›¾**ï¼šå½©è‰²ç¼–ç çš„æ·±åº¦

çª—å£æ˜¾ç¤ºä¿¡æ¯ï¼š
- å¸§æ•°
- FPS
- æ¨ç†æ—¶é—´
- æ·±åº¦èŒƒå›´

## ğŸ”§ æ•…éšœæ’é™¤

### 1. æ¨¡å‹åŠ è½½å¤±è´¥
```
é”™è¯¯: æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨
è§£å†³: æ£€æŸ¥ model_path å‚æ•°ï¼Œç¡®ä¿æ¨¡å‹æ–‡ä»¶å­˜åœ¨
```

### 2. CUDA å†…å­˜ä¸è¶³
```
é”™è¯¯: CUDA out of memory
è§£å†³: 
- å‡å°‘ valid_iters
- ä½¿ç”¨æ›´å°çš„ç¼–ç å™¨ (vits)
- é™ä½è¾“å…¥å›¾åƒåˆ†è¾¨ç‡
```

### 3. æ²¡æœ‰æ”¶åˆ°å›¾åƒ
```
é”™è¯¯: ç­‰å¾…å›¾åƒæ•°æ®...
è§£å†³:
- æ£€æŸ¥ ORB-SLAM3 æ˜¯å¦æ­£åœ¨è¿è¡Œ
- ç¡®è®¤è¯é¢˜åç§°æ­£ç¡®: /orb_slam3/image_pose_stereo
- ä½¿ç”¨ rostopic list æ£€æŸ¥è¯é¢˜
```

### 4. PyTorch æœªå®‰è£…
```
é”™è¯¯: ModuleNotFoundError: No module named 'torch'
è§£å†³: pip3 install torch torchvision
```

## ğŸ“š æŠ€æœ¯ç»†èŠ‚

### æ·±åº¦ä¼°è®¡æµç¨‹

1. **ç‰¹å¾æå–**
   - ä½¿ç”¨ Depth Anything V2 çš„ ViT ç¼–ç å™¨
   - æå–å¤šå°ºåº¦ç‰¹å¾ (4x, 8x, 16x)

2. **ä»£ä»·ä½“ç§¯æ„å»º**
   - å…¨å±€ä»£ä»·ä½“ç§¯ (1/16 åˆ†è¾¨ç‡)
   - å±€éƒ¨ä»£ä»·ä½“ç§¯ (1/8, 1/4 åˆ†è¾¨ç‡)

3. **è¿­ä»£ä¼˜åŒ–**
   - GRU æ›´æ–°ç½‘ç»œ
   - Scale-Shift å¯¹é½
   - åŒåˆ†æ”¯èåˆ

4. **ä¸Šé‡‡æ ·**
   - è½¯ä¸Šé‡‡æ ·åˆ°åŸå§‹åˆ†è¾¨ç‡
   - ä¿ç•™è¾¹ç¼˜ç»†èŠ‚

### æ€§èƒ½æŒ‡æ ‡

| é…ç½® | åˆ†è¾¨ç‡ | FPS | ç²¾åº¦ |
|------|--------|-----|------|
| ViT-S | 640x480 | ~15 | é«˜ |
| ViT-B | 640x480 | ~10 | å¾ˆé«˜ |
| ViT-L | 640x480 | ~5 | æé«˜ |

## ğŸ“– å‚è€ƒæ–‡çŒ®

- [Depth Anything V2](https://github.com/DepthAnything/Depth-Anything-V2)
- [MonSter: Monocular Stereo Depth Estimation](https://arxiv.org/abs/xxxx.xxxxx)

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¥ ä½œè€…

SunTeng - sunteng@example.com

## ğŸ™ è‡´è°¢

- Depth Anything V2 å›¢é˜Ÿ
- ORB-SLAM3 å›¢é˜Ÿ
- ROS ç¤¾åŒº