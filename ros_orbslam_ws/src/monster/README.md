# Monster - åŒç›®æ·±åº¦ä¼°è®¡ä¸å»ºå›¾ ROS åŠŸèƒ½åŒ…

Monster æ˜¯ä¸€ä¸ªåŸºäºæ·±åº¦å­¦ä¹ çš„åŒç›®æ·±åº¦ä¼°è®¡ ROS åŠŸèƒ½åŒ…ï¼Œç»“åˆäº†å•ç›®æ·±åº¦å…ˆéªŒï¼ˆDepth Anything V2ï¼‰å’Œç«‹ä½“åŒ¹é…æŠ€æœ¯ï¼Œæä¾›é«˜è´¨é‡çš„å®æ—¶æ·±åº¦ä¼°è®¡ã€ç‚¹äº‘ç”Ÿæˆå’Œ 2D åœ°å›¾æ„å»ºã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- **æ··åˆæ·±åº¦ä¼°è®¡**ï¼šç»“åˆå•ç›®å…ˆéªŒå’ŒåŒç›®ç«‹ä½“åŒ¹é…
- **å¤šå°ºåº¦å¤„ç†**ï¼š1/16 â†’ 1/8 â†’ 1/4 åˆ†è¾¨ç‡çš„ç²—åˆ°ç²¾ç­–ç•¥
- **å®æ—¶æ€§èƒ½**ï¼šä¼˜åŒ–çš„æ¨ç†é€Ÿåº¦ï¼Œæ”¯æŒå®æ—¶åº”ç”¨
- **ROS é›†æˆ**ï¼šå®Œæ•´çš„ ROS æ¥å£ï¼Œæ˜“äºé›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ
- **å¯è§†åŒ–æ”¯æŒ**ï¼šå®æ—¶æ˜¾ç¤ºåŸå›¾ã€è§†å·®å›¾å’Œæ·±åº¦å›¾
- **ç‚¹äº‘ç”Ÿæˆ**ï¼šä»æ·±åº¦å›¾ç”Ÿæˆå½©è‰²ç‚¹äº‘
- **2D åœ°å›¾æ„å»º**ï¼šç”Ÿæˆ OccupancyGrid å ç”¨æ …æ ¼åœ°å›¾
- **é‡åŠ›å¯¹é½**ï¼šè‡ªåŠ¨ä¼°è®¡é‡åŠ›æ–¹å‘å¹¶å¯¹é½ç‚¹äº‘
- **æ»‘åŠ¨çª—å£**ï¼šæ”¯æŒæ»‘åŠ¨çª—å£æ¨¡å¼ï¼Œé¿å…ç‚¹äº‘è¿‡åº¦ç´¯ç§¯

## ğŸ¯ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Monster æ·±åº¦ä¼°è®¡ç³»ç»Ÿ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  è¾“å…¥: ImagePoseStereo (å·¦å›¾ + å³å›¾ + ä½å§¿)                  â”‚
â”‚    â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  1. å•ç›®æ·±åº¦å…ˆéªŒ (Depth Anything V2)        â”‚           â”‚
â”‚  â”‚     - ViT ç¼–ç å™¨æå–ç‰¹å¾                     â”‚           â”‚
â”‚  â”‚     - ç”Ÿæˆå•ç›®æ·±åº¦ä¼°è®¡                       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚    â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  2. ç«‹ä½“åŒ¹é…                                 â”‚           â”‚
â”‚  â”‚     - æ„å»ºä»£ä»·ä½“ç§¯ (Cost Volume)             â”‚           â”‚
â”‚  â”‚     - å‡ ä½•ç¼–ç ä½“ç§¯                           â”‚           â”‚
â”‚  â”‚     - GRU è¿­ä»£ä¼˜åŒ–                           â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚    â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  3. æ·±åº¦èåˆ                                 â”‚           â”‚
â”‚  â”‚     - Scale-Shift å¯¹é½                       â”‚           â”‚
â”‚  â”‚     - åŒåˆ†æ”¯æ›´æ–°                             â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚    â†“                                                          â”‚
â”‚  è¾“å‡º: è§†å·®å›¾ + æ·±åº¦å›¾ + å¯è§†åŒ–                              â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ ä¾èµ–é¡¹

### ROS ä¾èµ–
- `rospy`
- `sensor_msgs`
- `geometry_msgs`
- `cv_bridge`
- `message_filters`

### Python ä¾èµ–
- `torch >= 1.10`
- `torchvision`
- `opencv-python`
- `numpy`

### æ¨¡å‹æ–‡ä»¶
- Depth Anything V2 é¢„è®­ç»ƒæ¨¡å‹
- Monster é¢„è®­ç»ƒæƒé‡ï¼š`checkpoints/Zero_shot.pth`

## ğŸš€ å®‰è£…

### 1. å…‹éš†ä»“åº“
```bash
cd ~/catkin_ws/src
# å‡è®¾å·²ç»åœ¨ orbslam_depthmaping_ros_2 é¡¹ç›®ä¸­
```

### 2. å®‰è£… Python ä¾èµ–
```bash
pip3 install torch torchvision opencv-python numpy
```

### 3. ä¸‹è½½æ¨¡å‹æ–‡ä»¶
å°† Monster æ¨¡å‹æ–‡ä»¶æ”¾ç½®åœ¨ `checkpoints/` ç›®å½•ï¼š
```bash
mkdir -p checkpoints
# ä¸‹è½½ Zero_shot.pth å’Œ depth_anything_v2_vits.pth
```

### 4. ç¼–è¯‘åŠŸèƒ½åŒ…
```bash
cd ~/catkin_ws
catkin_make
source devel/setup.bash
```

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨

å¯åŠ¨ Monster æ·±åº¦ä¼°è®¡ä¸å»ºå›¾èŠ‚ç‚¹ï¼š
```bash
roslaunch monster monster_stereo.launch
```

### 2. å¯åŠ¨é‡åŠ›ä¼°è®¡ï¼ˆå¯é€‰ï¼‰

é‡åŠ›ä¼°è®¡è„šæœ¬ä½¿ç”¨ **GeoCalib** æ¨¡å‹ï¼Œéœ€è¦åœ¨ **conda ç¯å¢ƒ**ä¸­è¿è¡Œã€‚

#### å‰ææ¡ä»¶
- å·²å®‰è£… conda ç¯å¢ƒ `plato`
- åœ¨ `plato` ç¯å¢ƒä¸­å®‰è£…äº† `geocalib` åº“

```bash
# åˆ›å»º conda ç¯å¢ƒï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
conda create -n plato python=3.8
conda activate plato

# å®‰è£… geocalib
pip install geocalib torch torchvision opencv-python pyyaml
```

#### å¯åŠ¨é‡åŠ›ä¼°è®¡è„šæœ¬

åœ¨å¦ä¸€ä¸ªç»ˆç«¯å¯åŠ¨é‡åŠ›ä¼°è®¡è„šæœ¬ï¼š
```bash
cd $(rospack find monster)/scripts/gravity_estimator
./run_gravity_estimator.sh
```

#### è‡ªå®šä¹‰ç›®æ ‡é‡åŠ›æ–¹å‘

é»˜è®¤ç›®æ ‡é‡åŠ›æ–¹å‘ä¸º `[0, -1, 0]` (Yè½´å‘ä¸‹)ã€‚å¯ä»¥é€šè¿‡å‚æ•°è‡ªå®šä¹‰ï¼š

```bash
# Zè½´å‘ä¸Š
./run_gravity_estimator.sh "0 0 1"

# Xè½´å‘å³
./run_gravity_estimator.sh "1 0 0"

# Yè½´å‘ä¸Šï¼ˆä¸é»˜è®¤ç›¸åï¼‰
./run_gravity_estimator.sh "0 1 0"
```

#### ç¯å¢ƒå˜é‡é…ç½®

å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è°ƒæ•´å‚æ•°ï¼š
```bash
# è®¾ç½®æ›´æ–°é—´éš”ä¸º 0.5 ç§’
INTERVAL=0.5 ./run_gravity_estimator.sh

# è®¾ç½®ä½å§¿è·³å˜é˜ˆå€¼ä¸º 2.0 ç±³
POSE_JUMP_THRESHOLD=2.0 ./run_gravity_estimator.sh
```

### 3. è‡ªå®šä¹‰å‚æ•°

ä½¿ç”¨è‡ªå®šä¹‰é…ç½®ï¼š
```bash
roslaunch monster monster_stereo.launch \
    model_path:=/path/to/model.pth \
    encoder:=vits \
    baseline:=0.12 \
    focal_length:=500.0 \
    display:=true
```

### 4. ä¸ ORB-SLAM3 é›†æˆ

ç¡®ä¿ ORB-SLAM3 å‘å¸ƒ `/orb_slam3/image_pose_stereo` è¯é¢˜ï¼š
```bash
# ç»ˆç«¯ 1: å¯åŠ¨ ORB-SLAM3 (åŒç›®æ¨¡å¼)
roslaunch orb_slam3_ros stereo.launch

# ç»ˆç«¯ 2: å¯åŠ¨ Monster æ·±åº¦ä¼°è®¡ä¸å»ºå›¾
roslaunch monster monster_stereo.launch

# ç»ˆç«¯ 3: å¯åŠ¨é‡åŠ›ä¼°è®¡ï¼ˆå¯é€‰ï¼‰
cd $(rospack find monster)/scripts/gravity_estimator
./run_gravity_estimator.sh
```

### 5. åœ¨ RViz ä¸­å¯è§†åŒ–

```bash
rviz
```

æ·»åŠ ä»¥ä¸‹æ˜¾ç¤ºï¼š
- **PointCloud2**: è¯é¢˜ `/o3d_pointCloud`ï¼Œå›ºå®šåæ ‡ç³» `map`
- **Map**: è¯é¢˜ `/projected_map`ï¼Œå›ºå®šåæ ‡ç³» `map`

## âš™ï¸ é…ç½®å‚æ•°

### æ¨¡å‹å‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `model_path` | string | `checkpoints/Zero_shot.pth` | æ¨¡å‹æƒé‡è·¯å¾„ |
| `encoder` | string | `vits` | ç¼–ç å™¨ç±»å‹ (vits/vitb/vitl/vitg) |
| `valid_iters` | int | `2` | æ¨ç†è¿­ä»£æ¬¡æ•° |

### ç›¸æœºå‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `baseline` | float | `0.12` | åŒç›®åŸºçº¿è·ç¦» (ç±³) |
| `focal_length` | float | `500.0` | ç„¦è· (åƒç´ ) |

### æ¶æ„å‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `hidden_dims` | list | `[32, 64, 96]` | éšè—å±‚ç»´åº¦ |
| `max_disp` | int | `416` | æœ€å¤§è§†å·® |
| `n_gru_layers` | int | `3` | GRU å±‚æ•° |

### æ˜¾ç¤ºå‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `display` | bool | `true` | æ˜¯å¦æ˜¾ç¤ºå¯è§†åŒ–çª—å£ |

### ç‚¹äº‘ç”Ÿæˆå‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `point_cloud.filter.max_depth` | float | `100.0` | æœ€å¤§æ·±åº¦é˜ˆå€¼ (ç±³) |
| `point_cloud.filter.height_filter_mode` | string | `relative` | é«˜åº¦è¿‡æ»¤æ¨¡å¼ |
| `point_cloud.filter.height_ratio_range` | list | `[0.3, 1.0]` | é«˜åº¦æ¯”ä¾‹èŒƒå›´ |
| `point_cloud.voxel_size` | float | `1.0` | ä½“ç´ ä¸‹é‡‡æ ·å¤§å° (ç±³) |

### åœ°å›¾æ„å»ºå‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `map.sliding_window.enabled` | bool | `true` | æ˜¯å¦å¯ç”¨æ»‘åŠ¨çª—å£ |
| `map.sliding_window.size` | int | `3` | æ»‘åŠ¨çª—å£å¤§å° (å¸§æ•°) |
| `map.resolution` | float | `0.8` | åœ°å›¾åˆ†è¾¨ç‡ (ç±³/æ ¼) |
| `map.height_range` | list | `[0.3, 0.7]` | 2Dåœ°å›¾é«˜åº¦èŒƒå›´ |
| `map.occupied_thresh` | int | `3` | å ç”¨é˜ˆå€¼ (ç‚¹æ•°) |

### é‡åŠ›å¯¹é½å‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `gravity_alignment.enabled` | bool | `true` | æ˜¯å¦å¯ç”¨é‡åŠ›å¯¹é½ |
| `gravity_alignment.save_interval` | float | `1.0` | ä¿å­˜é—´éš” (ç§’) |
| `gravity_alignment.check_interval` | float | `0.5` | æ£€æŸ¥é—´éš” (ç§’) |

## ğŸ“Š è¯é¢˜æ¥å£

### è®¢é˜…è¯é¢˜
- `/orb_slam3/image_pose_stereo` ([`monster/ImagePoseStereo`](msg/ImagePoseStereo.msg))
  - åŒ…å«å·¦å³å›¾åƒã€ç›¸æœºä½å§¿å’Œè·Ÿè¸ªçŠ¶æ€

### å‘å¸ƒè¯é¢˜
- `/o3d_pointCloud` ([`sensor_msgs/PointCloud2`](http://docs.ros.org/api/sensor_msgs/html/msg/PointCloud2.html))
  - å½©è‰²ç‚¹äº‘æ•°æ®ï¼ˆå¸¦é‡åŠ›å¯¹é½ï¼‰
- `/projected_map` ([`nav_msgs/OccupancyGrid`](http://docs.ros.org/api/nav_msgs/html/msg/OccupancyGrid.html))
  - 2D å ç”¨æ …æ ¼åœ°å›¾

## ğŸ¨ å¯è§†åŒ–

èŠ‚ç‚¹è¿è¡Œæ—¶ä¼šæ˜¾ç¤ºä¸‰ä¸ªçª—å£ï¼š
1. **åŸå§‹å›¾åƒ**ï¼šå·¦ç›¸æœºå›¾åƒ
2. **è§†å·®å›¾**ï¼šå½©è‰²ç¼–ç çš„è§†å·®
3. **æ·±åº¦å›¾**ï¼šå½©è‰²ç¼–ç çš„æ·±åº¦

çª—å£æ˜¾ç¤ºä¿¡æ¯ï¼š
- å¸§æ•°
- FPS
- æ¨ç†æ—¶é—´
- æ·±åº¦èŒƒå›´

## ğŸ”§ æ•…éšœæ’é™¤

### 1. æ¨¡å‹åŠ è½½å¤±è´¥
```
é”™è¯¯: æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨
è§£å†³: æ£€æŸ¥ model_path å‚æ•°ï¼Œç¡®ä¿æ¨¡å‹æ–‡ä»¶å­˜åœ¨
```

### 2. CUDA å†…å­˜ä¸è¶³
```
é”™è¯¯: CUDA out of memory
è§£å†³: 
- å‡å°‘ valid_iters
- ä½¿ç”¨æ›´å°çš„ç¼–ç å™¨ (vits)
- é™ä½è¾“å…¥å›¾åƒåˆ†è¾¨ç‡
```

### 3. æ²¡æœ‰æ”¶åˆ°å›¾åƒ
```
é”™è¯¯: ç­‰å¾…å›¾åƒæ•°æ®...
è§£å†³:
- æ£€æŸ¥ ORB-SLAM3 æ˜¯å¦æ­£åœ¨è¿è¡Œ
- ç¡®è®¤è¯é¢˜åç§°æ­£ç¡®: /orb_slam3/image_pose_stereo
- ä½¿ç”¨ rostopic list æ£€æŸ¥è¯é¢˜
```

### 4. PyTorch æœªå®‰è£…
```
é”™è¯¯: ModuleNotFoundError: No module named 'torch'
è§£å†³: pip3 install torch torchvision
```

## ğŸ“š æŠ€æœ¯ç»†èŠ‚

### æ·±åº¦ä¼°è®¡æµç¨‹

1. **ç‰¹å¾æå–**
   - ä½¿ç”¨ Depth Anything V2 çš„ ViT ç¼–ç å™¨
   - æå–å¤šå°ºåº¦ç‰¹å¾ (4x, 8x, 16x)

2. **ä»£ä»·ä½“ç§¯æ„å»º**
   - å…¨å±€ä»£ä»·ä½“ç§¯ (1/16 åˆ†è¾¨ç‡)
   - å±€éƒ¨ä»£ä»·ä½“ç§¯ (1/8, 1/4 åˆ†è¾¨ç‡)

3. **è¿­ä»£ä¼˜åŒ–**
   - GRU æ›´æ–°ç½‘ç»œ
   - Scale-Shift å¯¹é½
   - åŒåˆ†æ”¯èåˆ

4. **ä¸Šé‡‡æ ·**
   - è½¯ä¸Šé‡‡æ ·åˆ°åŸå§‹åˆ†è¾¨ç‡
   - ä¿ç•™è¾¹ç¼˜ç»†èŠ‚

### æ€§èƒ½æŒ‡æ ‡

| é…ç½® | åˆ†è¾¨ç‡ | FPS | ç²¾åº¦ |
|------|--------|-----|------|
| ViT-S | 640x480 | ~15 | é«˜ |
| ViT-B | 640x480 | ~10 | å¾ˆé«˜ |
| ViT-L | 640x480 | ~5 | æé«˜ |

## ğŸ—ºï¸ å»ºå›¾åŠŸèƒ½è¯´æ˜

### ç‚¹äº‘ç”Ÿæˆæµç¨‹

1. **æ·±åº¦å›¾ç”Ÿæˆ**ï¼šMonster æ¨¡å‹ä¼°è®¡åŒç›®æ·±åº¦
2. **ç‚¹äº‘æŠ•å½±**ï¼šå°†æ·±åº¦å›¾æŠ•å½±åˆ° 3D ç©ºé—´
3. **åæ ‡å˜æ¢**ï¼šä½¿ç”¨ ORB-SLAM3 ä½å§¿è½¬æ¢åˆ°ä¸–ç•Œåæ ‡ç³»
4. **ç‚¹äº‘è¿‡æ»¤**ï¼šé«˜åº¦è¿‡æ»¤ã€æ·±åº¦èŒƒå›´è¿‡æ»¤
5. **ä½“ç´ ä¸‹é‡‡æ ·**ï¼šå‡å°‘ç‚¹äº‘å¯†åº¦
6. **é‡åŠ›å¯¹é½**ï¼šåº”ç”¨é‡åŠ›å¯¹é½çŸ©é˜µï¼ˆå¦‚æœå¯ç”¨ï¼‰

### 2D åœ°å›¾ç”Ÿæˆæµç¨‹

1. **é«˜åº¦åˆ‡ç‰‡**ï¼šä»ç‚¹äº‘ä¸­æå–ç‰¹å®šé«˜åº¦èŒƒå›´çš„ç‚¹
2. **æ …æ ¼æŠ•å½±**ï¼šå°† 3D ç‚¹æŠ•å½±åˆ° 2D å¹³é¢
3. **å ç”¨åˆ¤æ–­**ï¼šæ ¹æ®ç‚¹æ•°é˜ˆå€¼åˆ¤æ–­æ …æ ¼å ç”¨çŠ¶æ€
4. **åœ°å›¾å‘å¸ƒ**ï¼šå‘å¸ƒ OccupancyGrid æ¶ˆæ¯

### é‡åŠ›ä¼°è®¡åŸç†

é‡åŠ›ä¼°è®¡è„šæœ¬ä½¿ç”¨ **GeoCalib** æ¨¡å‹ï¼Œé€šè¿‡æ–‡ä»¶å¤¹ä¸ä¸»ç¨‹åºé€šä¿¡ï¼š

1. **ä¸»ç¨‹åº**ï¼šå®šæœŸä¿å­˜å›¾åƒå’Œä½å§¿åˆ° `GE_information/` ç›®å½•
   - ä¿å­˜é¢‘ç‡ï¼š`gravity_alignment.save_interval` (é»˜è®¤ 1.0 ç§’)
   - ä¿å­˜æ–‡ä»¶ï¼š`latest_img.png` (å›¾åƒ) å’Œ `latest_pose.json` (ä½å§¿)

2. **é‡åŠ›ä¼°è®¡è„šæœ¬**ï¼ˆåœ¨ conda ç¯å¢ƒä¸­è¿è¡Œï¼‰ï¼š
   - ä½¿ç”¨ **GeoCalib** æ¨¡å‹ä»å›¾åƒä¼°è®¡ç›¸æœºåæ ‡ç³»ä¸‹çš„é‡åŠ›æ–¹å‘
   - ç»“åˆ ORB-SLAM3 ä½å§¿å°†é‡åŠ›è½¬æ¢åˆ°ä¸–ç•Œåæ ‡ç³»
   - è®¡ç®—å¯¹é½æ—‹è½¬çŸ©é˜µ `R_align`ï¼Œå°†ä¼°è®¡çš„é‡åŠ›å¯¹é½åˆ°ç›®æ ‡æ–¹å‘
   - ä¿å­˜åˆ° `rotation_matrices.yaml`
   - æ£€æµ‹ä½å§¿è·³å˜ï¼ˆORB-SLAM3 é‡æ–°åˆå§‹åŒ–ï¼‰å¹¶é‡æ–°è®¡ç®—

3. **ä¸»ç¨‹åº**ï¼šå®šæœŸåŠ è½½æœ€æ–°çš„å¯¹é½çŸ©é˜µå¹¶åº”ç”¨åˆ°ç‚¹äº‘
   - æ£€æŸ¥é¢‘ç‡ï¼š`gravity_alignment.check_interval` (é»˜è®¤ 0.5 ç§’)
   - åº”ç”¨åˆ°ç‚¹äº‘ï¼š`points_aligned = points @ R_align.T`

#### GeoCalib æ¨¡å‹

GeoCalib æ˜¯ä¸€ä¸ªåŸºäºæ·±åº¦å­¦ä¹ çš„ç›¸æœºæ ‡å®šæ¨¡å‹ï¼Œå¯ä»¥ä»å•å¼ å›¾åƒä¼°è®¡ï¼š
- é‡åŠ›æ–¹å‘ï¼ˆgravity vectorï¼‰
- ç„¦è·ï¼ˆfocal lengthï¼‰
- ç›¸æœºå€¾æ–œè§’åº¦ï¼ˆroll, pitchï¼‰

åœ¨ Monster ä¸­ï¼Œæˆ‘ä»¬åªä½¿ç”¨å…¶é‡åŠ›ä¼°è®¡åŠŸèƒ½ã€‚

#### ä¸ºä»€ä¹ˆéœ€è¦ç‹¬ç«‹ç¯å¢ƒï¼Ÿ

- GeoCalib ä¾èµ–ç‰¹å®šç‰ˆæœ¬çš„ PyTorch å’Œå…¶ä»–åº“
- å¯èƒ½ä¸ ROS ç¯å¢ƒçš„ Python ç‰ˆæœ¬å†²çª
- ä½¿ç”¨ conda ç¯å¢ƒéš”ç¦»å¯ä»¥é¿å…ä¾èµ–å†²çª

### æ–‡ä»¶å¤¹é€šä¿¡æœºåˆ¶

```
scripts/GE_information/
â”œâ”€â”€ latest_img.png          # æœ€æ–°å›¾åƒ (640x480, BGR)
â”œâ”€â”€ latest_pose.json        # æœ€æ–°ä½å§¿ (R_cw, t_cw, timestamp, frame_id)
â””â”€â”€ rotation_matrices.yaml  # é‡åŠ›å¯¹é½çŸ©é˜µ (R_align, g_aligned, g_w_slam, etc.)
```

#### latest_pose.json æ ¼å¼
```json
{
  "image_path": "/path/to/latest_img.png",
  "timestamp": 1234567890.123,
  "frame_id": 42,
  "R_cw": [[...], [...], [...]],  // 3x3 æ—‹è½¬çŸ©é˜µ
  "t_cw": [x, y, z]                // 3D å¹³ç§»å‘é‡
}
```

#### rotation_matrices.yaml æ ¼å¼
```yaml
R_align:          # å¯¹é½æ—‹è½¬çŸ©é˜µ (3x3)
- [r11, r12, r13]
- [r21, r22, r23]
- [r31, r32, r33]
g_aligned:        # å¯¹é½åçš„é‡åŠ› (åº”è¯¥æ¥è¿‘ç›®æ ‡æ–¹å‘)
- gx
- gy
- gz
g_w_slam:         # ä¸–ç•Œåæ ‡ç³»ä¸‹çš„ä¼°è®¡é‡åŠ›
- gx
- gy
- gz
g_target:         # ç›®æ ‡é‡åŠ›æ–¹å‘
- tx
- ty
- tz
g_c:              # ç›¸æœºåæ ‡ç³»ä¸‹çš„é‡åŠ› (GeoCalib è¾“å‡º)
- gx
- gy
- gz
timestamp: 1234567890.123
frame_id: 42
```

## ï¿½ å‚è€ƒæ–‡çŒ®

- [Depth Anything V2](https://github.com/DepthAnything/Depth-Anything-V2)
- [MonSter: Monocular Stereo Depth Estimation](https://arxiv.org/abs/xxxx.xxxxx)
- [ORB-SLAM3](https://github.com/UZ-SLAMLab/ORB_SLAM3)

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¥ ä½œè€…

SunTeng - sunteng@example.com

## ğŸ™ è‡´è°¢

- Depth Anything V2 å›¢é˜Ÿ
- ORB-SLAM3 å›¢é˜Ÿ
- ROS ç¤¾åŒº